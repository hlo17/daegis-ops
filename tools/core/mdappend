#!/usr/bin/env bash
set -euo pipefail
OUTDIR="${MD_OUTDIR:-$HOME/daegis/docs}"
arg="${1:-}"
[[ -n "$arg" ]] || { echo "usage: mdappend <path-or-file>"; exit 1; }

case "$arg" in
  /*) target="$arg" ;;
  *)  target="$OUTDIR/$arg" ;;
esac

mkdir -p "$(dirname "$target")"
touch "$target"
# 末尾が改行で終わっていなければ改行を追加
if [[ -s "$target" ]] && [[ "$(tail -c1 "$target" || true)" != $'\n' ]]; then
  echo >> "$target"
fi
cat >> "$target"
echo "appended: $target"
