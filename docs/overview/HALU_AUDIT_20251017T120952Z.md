# Halu Audit (20251017T120952Z)

## 1) agent.md / 定義ファイル探索
 - docs/agents/halu/agent.md (present)

## 2) リポジトリ内の Halu 関連ファイル（パスだけ）
 - config/halu_modes.yaml:4:  default: { route: "Halu" }
 - metrics/lyra_mode.prom:7:lyra_mode_count{mode="Halu"} 0
 - bridges/obsidian/derived/dashboard_ad5f9xd.json:109:          "expr": "time() - daegis_memory_last_update_timestamp{agent=~\"Lyra|Kai|Halu|Memory\"}",
 - inbox/window/20251012T185812Z_dna_schema_result.md:22:- Halu Rely 統合スキーマ 設計へ 橋渡し可能
 - inbox/window/20251017T120136Z_halu_audit_result.md:4:topic: "Halu Audit — 現存パス/証跡の棚卸し（DRY）"
 - inbox/window/20251017T120136Z_halu_audit_result.md:12:- Halu関連の定義/メトリクス/監査/WORM/ミラーの痕跡を1枚に集約（破壊なし）
 - inbox/window/20251017T120609Z_halu_hardening_v1_done.md:4:topic: "Halu Hardening v1（DRY）— SOT固定・Sentry・Router導入"
 - inbox/window/20251017T120609Z_halu_hardening_v1_done.md:11:- Halu最小SOT（agent.md / halu.prom / relay stub / config）を固定。WORM/busを新設。
 - inbox/window/20251017T120609Z_halu_hardening_v1_done.md:12:- `halu_sentry.sh`で存在・鮮度を監視し、`:9091`へ常時鏡出（daegis_halu_sentry_ok 等）。
 - inbox/window/20251017T113132Z_ack_state_sync.md:18:- Kaiは Halu :9091 鏡出（DRY, textfile: logs/prom/halu.prom）を実施。
 - inbox/window/20251017T113509Z_halu_9091_mirror_result.md:4:topic: "Halu :9091 鏡出（DRY） — 点灯・証跡提出"
 - inbox/window/20251017T113509Z_halu_9091_mirror_result.md:12:- :9091 に daegis_halu_* が点灯（pass_ratio/cases/情報ラベル）
 - inbox/window/20251017T113509Z_halu_9091_mirror_result.md:24:{"ts":"2025-10-17T11:34:59Z","test":"HaluEvalLowPassRate","mode":"DRY","result":"would_fire_then_resolve","note":"pass_ratio<0.70 for 10m (simulated)"}
 - ops/prom_text/daegis_memory.prom:4:daegis_memory_last_update_timestamp{agent="Halu"} 0
 - ops/ward/Daegis-Ward.md:45:- defaults: SENTRY=on, WSS/ACAP/SlackDigest/HaluRelay=off (ops/policies/toggles.env)
 - ops/ward/Daegis-Ward.md:185:## Halu setup snapshot (20251006-181604)
 - ops/ward/Daegis-Ward.md:190:## Halu setup snapshot (2025-10-06T18:18:18+0900)
 - ops/ward/audit-halu-20251006-213459.md:1:# Halu Audit (2025-10-06T21:34:59+09:00)
 - ops/prom_text/relay_heartbeat.prom:1:relay_last_update_seconds{agent="Halu"} 1760400598
 - ops/grafana/memory_observer_dashboard.json:16:          { "expr": "(time() - daegis_memory_last_update_timestamp{agent=~\"Lyra|Kai|Halu|Memory\"}) / 60",
 - ops/tools/seed.sh:11:- Architecture: Halu (core KB) + Sora (interface)
 - ops/runbooks/chronicles/Daegis Chronicle 2025-09-28.md:41:- Halu-RAG 修正 → テスト 5/5 GREEN
 - ops/runbooks/hand-offs/Daegis Hand-off 2025-09-28.md:4:- **Scope**: Haluパイプライン（Broker→Relay→Scribe→Ledger/Slack）安定化・運用基盤整備（Sentry/Runbook/GitHub）
 - ops/runbooks/hand-offs/Daegis Hand-off 2025-09-28.md:55:📌 **Status**: Haluパイプラインの観測・切り分けは安定。次は**通知の貫通**と**重複判定の恒久化**。
 - ops/runbooks/Daegis-Runbook.md:38:- Core Agents → Halu, Grok, Perplexity, Gemini, ChatGPT, NotebookLM
 - ops/runbooks/Daegis-Runbook.md:39:- Interaction → Slack + (Halu Relay: OFF until Slack digest wired)
 - ops/runbooks/Daegis-Runbook.md:45:Sentry=ON / WSS=OFF / ACAP=OFF / SlackDigest=OFF / HaluRelay=OFF
 - ops/runbooks/Daegis-Runbook.md:51:**要約**: DaegisはAI騎士団を中心とした自律型情報処理システム。MQTT Busを神経系、Slackを円卓とする最小国家構想。進捗: M3完了、M4/M5進行中。弱点対処優先で、Halu Relay活性化を即時実施。  
 - ops/runbooks/Daegis-Runbook.md:55:- **即時(1h)**: Slack #daegis-roundtable 召集（ACAPテンプレ使用）。Halu Relay PoC再実行（MQTT→Slack）。
 - ops/runbooks/Daegis-Runbook.md:63:- **Daegis Factory**: DAGタスク（plan→publish）🚧（Halu連携）
 - ops/runbooks/Daegis-Runbook.md:75:- **Halu + (Halu Relay / Knowledge Engine)**: 議長・中継・RAG ✅/❌（Relay活性化優先）
 - ops/setup-halu.sh:55:    echo "## Halu setup snapshot ($TS)"
 - logs/prom/halu.prom:1:# HELP daegis_halu_sentry_ok 1=healthy 0=problem
 - logs/prom/halu.prom:2:# TYPE daegis_halu_sentry_ok gauge
 - logs/prom/halu.prom:3:daegis_halu_sentry_ok 1
 - logs/prom/halu.prom:4:# HELP daegis_halu_textfile_age_seconds seconds since halu.prom last write
 - logs/prom/halu.prom:5:# TYPE daegis_halu_textfile_age_seconds gauge
 - logs/prom/halu.prom:6:daegis_halu_textfile_age_seconds 238
 - logs/prom/halu.prom:7:# HELP daegis_halu_eval_pass_ratio_1h Halu pass ratio (1h avg; DRY default 0)
 - logs/prom/halu.prom:8:# TYPE daegis_halu_eval_pass_ratio_1h gauge
 - logs/prom/halu.prom:9:daegis_halu_eval_pass_ratio_1h 0
 - logs/prom/halu.prom:10:# HELP daegis_halu_eval_cases_1h Cases (1h total; DRY default 0)
 - logs/prom/halu.prom:11:# TYPE daegis_halu_eval_cases_1h gauge
 - logs/prom/halu.prom:12:daegis_halu_eval_cases_1h{status="total"} 0
 - logs/prom/halu.prom:13:# HELP daegis_halu_eval_cases_24h Cases (24h total; DRY default 0)
 - logs/prom/halu.prom:14:# TYPE daegis_halu_eval_cases_24h gauge
 - logs/prom/halu.prom:15:daegis_halu_eval_cases_24h{status="total"} 2.0256410256410255
 - logs/prom/halu.prom:16:# HELP daegis_halu_info meta
 - logs/prom/halu.prom:17:# TYPE daegis_halu_info gauge
 - logs/prom/halu.prom:18:daegis_halu_info{source="sentry",mode="DRY"} 1
 - bin/memory_metrics.sh:12:  ["Halu"]="$BASE/Relay Halu.md"
 - brief.md:6:- Slack Slash → FastAPI(slack2mqtt) → MQTT → Halu / Oracle が稼働。Cloudflare Tunnel `bridge` でDNS確定。
 - scripts/guardian/window_route_via_halu.sh:10:# A) まずHaluのbusに「通過」を1行記録（WORM）
 - scripts/halu:14:  sentry           - Halu最小SOTの存在/鮮度チェック → :9091 鏡出
 - scripts/halu:15:  route <card.md>  - Garden GateカードをHalu経由で送信（bus.jsonlに記録）
 - scripts/halu:16:  emit             - Haluのprom行を生成/補完（emit_halu_prom.sh があれば実行）
 - scripts/halu:45:      echo "# Halu Audit (${ts})"
 - scripts/halu:54:      echo "## 2) リポジトリ内の Halu 関連ファイル（パスだけ）"
 - scripts/halu:56:        (cd "$ROOT" && rg -n --hidden --no-messages 'Halu|daegis_halu' || true) | sed 's/^/ - /' | head -n 80
 - scripts/halu:58:        (cd "$ROOT" && grep -RIn --exclude-dir='.git' -E 'Halu|daegis_halu' . 2>/dev/null || true) | sed 's/^/ - /' | head -n 80
 - scripts/halu:62:      (curl -fsS localhost:9091/metrics 2>/dev/null | grep -E '^daegis_halu_|^# HELP daegis_halu_' | head -n 30) 2>/dev/null \
 - scripts/halu:80:    (curl -fsS localhost:9091/metrics 2>/dev/null | grep -E '^daegis_halu_(sentry_ok|textfile_age_seconds|eval_)' || echo "(none)")
 - scripts/halu:95:    ( cd "$PUB" && git add docs/agents/halu/agent.md && git commit -m "mirror: update Halu agent canon" ) || true
 - scripts/ops/emit_halu_prom.sh:14:  echo '# HELP daegis_halu_eval_pass_ratio_1h Halu pass ratio (1h avg)'
 - scripts/ops/emit_halu_prom.sh:15:  echo '# TYPE daegis_halu_eval_pass_ratio_1h gauge'
 - scripts/ops/emit_halu_prom.sh:16:  printf 'daegis_halu_eval_pass_ratio_1h %s\n' "${pass}"
 - scripts/ops/emit_halu_prom.sh:18:  echo '# HELP daegis_halu_eval_cases_1h Cases in 1h by status (approx, DRY)'
 - scripts/ops/emit_halu_prom.sh:19:  echo '# TYPE daegis_halu_eval_cases_1h gauge'
 - scripts/ops/emit_halu_prom.sh:20:  printf 'daegis_halu_eval_cases_1h{status="total"} %s\n' "${case_pass_1h}"
 - scripts/ops/emit_halu_prom.sh:22:  echo '# HELP daegis_halu_eval_cases_24h Cases in 24h by status (approx, DRY)'
 - scripts/ops/emit_halu_prom.sh:23:  echo '# TYPE daegis_halu_eval_cases_24h gauge'
 - scripts/ops/emit_halu_prom.sh:24:  printf 'daegis_halu_eval_cases_24h{status="total"} %s\n' "${case_pass_24h}"
 - scripts/ops/emit_halu_prom.sh:26:  echo '# HELP daegis_halu_info meta'
 - scripts/ops/emit_halu_prom.sh:27:  echo '# TYPE daegis_halu_info gauge'
 - scripts/ops/emit_halu_prom.sh:28:  printf 'daegis_halu_info{source="mirror_9090",mode="DRY"} 1\n'
 - scripts/ops/halu_sentry.sh:20:  echo '# HELP daegis_halu_sentry_ok 1=healthy 0=problem'
 - scripts/ops/halu_sentry.sh:21:  echo '# TYPE daegis_halu_sentry_ok gauge'
 - scripts/ops/halu_sentry.sh:22:  echo "daegis_halu_sentry_ok ${ok}"
 - scripts/ops/halu_sentry.sh:23:  echo '# HELP daegis_halu_textfile_age_seconds seconds since halu.prom last write'
 - scripts/ops/halu_sentry.sh:24:  echo '# TYPE daegis_halu_textfile_age_seconds gauge'
